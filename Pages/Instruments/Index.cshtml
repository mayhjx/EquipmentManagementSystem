@page
@model EquipmentManagementSystem.Pages.Instruments.IndexModel

@{
    ViewData["Title"] = "主检设备";
}

<div class="card">
    <div class="card-header">
        <h3 class="card-title">
            信息一览
            <a asp-page="Create">
                <input type="button" class="btn btn-outline-primary btn-sm" value="新增设备" style="margin-left: 10px;">
            </a>
        </h3>
    </div>

    <div class="card-body">
        <div id="index_wrapper" class="dataTables_wrapper dt-bootstrap4">
            <div class="row">
                <div class="col-sm-12 col-md-6"></div>
                <div class="col-sm-12 col-md-6"></div>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <table id="index" class="table table-hover dataTable dtr-inline">
                        <thead>
                            <tr>
                                <th>
                                    @Html.DisplayNameFor(model => model.Instrument[0].ID)
                                </th>
                                <th>
                                    @Html.DisplayNameFor(model => model.Instrument[0].Name)
                                </th>
                                <th>
                                    计划@(Html.DisplayNameFor(model => model.Instrument[0].Calibrations.First().Date))
                                </th>
                                <th>
                                    @Html.DisplayNameFor(model => model.Instrument[0].ProjectTeamName)
                                </th>
                                <th>
                                    @Html.DisplayNameFor(model => model.Instrument[0].Location)
                                </th>
                                <th>
                                    @Html.DisplayNameFor(model => model.Instrument[0].Status)
                                </th>
                                <th>
                                    @Html.DisplayNameFor(model => model.Instrument[0].Remark)
                                </th>
                                <th>&nbsp</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.Instrument)
                            {
                                <tr>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.ID)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Name)
                                    </td>
                                    <td>
                                        @if (item.Calibrations.Count > 0)
                                        {
                                            var lastCalibrationDateTime = item.Calibrations.Last().Date;
                                            if (lastCalibrationDateTime != DateTime.MinValue)
                                            {
                                                @(lastCalibrationDateTime.AddYears(item.CalibrationCycle).AddDays(-1).ToShortDateString())
                                            }
                                        }
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.ProjectTeamName)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Location)
                                    </td>
                                    <td>
                                        @{
                                            var status = item.Status.ToString();
                                            if (status == "Using")
                                            {
                                                <span class="badge badge-success">正常</span>
                                            }
                                            else if (status == "Malfunction")
                                            {
                                                <span class="badge badge-warning">故障</span>
                                            }
                                            else if (status == "StopUsing")
                                            {
                                                <span class="badge badge-warning">停用</span>
                                            }
                                            else if (status == "Allocate")
                                            {
                                                <span class="badge badge-warning">调拨</span>
                                            }
                                            else if (status == "Scrapped")
                                            {
                                                <span class="badge badge-danger">报废</span>
                                            }
                                        }
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.Remark)
                                    </td>
                                    <td>
                                        @*<a asp-page="./Edit" asp-route-id="@item.ID">编辑</a> |*@
                                        <a asp-page="./Details" asp-route-id="@item.ID">详细信息</a>
                                        @* | <a asp-page="./Delete" asp-route-id="@item.ID">删除</a>*@
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @*<script src="~/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>*@
    <script src="~/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
    <script src="~/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
    <script>
        $(function () {
            $('#index').DataTable({
                paging: true,
                lengthChange: true,
                searching: true,
                ordering: true,
                orderMulti: true,
                info: true,
                autoWidth: false,
                responsive: true,
                processing: true,
                stateSave: true,
                deferRender: true,
                language: {
                    "emptyTable": "没有数据", //没有数据时要显示的字符串
                    "info": "当前 _START_ 条到 _END_ 条 共 _TOTAL_ 条",//左下角的信息，变量可以自定义，到官网详细查看
                    "infoEmpty": "无记录",//当没有数据时，左下角的信息
                    "infoFiltered": "(从 _MAX_ 条记录过滤)",//当表格过滤的时候，将此字符串附加到主要信息
                    "infoPostFix": "",//在摘要信息后继续追加的字符串
                    "thousands": ",",//千分位分隔符
                    "lengthMenu": "每页 _MENU_ 条记录",//用来描述分页长度选项的字符串
                    "loadingRecords": "加载中...",//用来描述数据在加载中等待的提示字符串 - 当异步读取数据的时候显示
                    "processing": "处理中...",//用来描述加载进度的字符串
                    "search": "搜索：",//用来描述搜索输入框的字符串
                    "zeroRecords": "没有找到",//当没有搜索到结果时，显示
                    "paginate": {
                        "first": "首页",
                        "previous": "上一页",
                        "next": "下一页",
                        "last": "尾页"
                    }
                },
            });
        })
    </script>
}
